---
name: develop
description: 开发实施阶段详细规则；进入开发实施时读取；包含代码执行、知识库同步、方案包迁移
---

# 开发实施 - 详细规则

**目标：** 按任务清单执行开发，同步知识库，迁移方案包

**执行流程：**
```
1. 读取任务清单
2. 按顺序执行任务
3. 更新任务状态
4. 同步知识库
5. 迁移方案包至 history/
6. 输出结果
```

---

## 步骤 1: 读取任务清单

```yaml
来源: .sopify/plan/{current_plan}/tasks.md
      或 .sopify/plan/{current_plan}/plan.md (light 级别)

解析: 提取所有 [ ] 待执行任务
排序: 按任务编号顺序执行
依赖: 检查任务间依赖关系
```

---

## 步骤 2: 执行任务

**执行原则：**
```yaml
每个任务:
  1. 定位目标文件
  2. 理解当前代码
  3. 实施修改
  4. 验证修改正确性
  5. 更新任务状态为 [x]

安全检查:
  - 不引入安全漏洞 (XSS, SQL注入等)
  - 不破坏现有功能
  - 保持代码风格一致
```

**任务状态更新：**
```yaml
成功完成: [ ] → [x]
跳过 (不需要): [ ] → [-]
阻塞 (需外部处理): [ ] → [!]
```

---

## 步骤 3: 知识库同步

**同步时机：**
- 每完成一个模块的任务
- 开发实施阶段结束时

**同步内容：**
```yaml
wiki/modules/{module}.md:
  - 更新模块职责描述 (如有变更)
  - 添加新的 API 接口文档
  - 更新数据模型说明

wiki/overview.md:
  - 更新模块索引 (如有新模块)
  - 更新快速链接

project.md:
  - 更新技术约定 (如有变更)
```

---

## 步骤 4: 方案包迁移

**迁移路径：**
```
.sopify/plan/YYYYMMDD_feature/
    ↓ 移动至
.sopify/history/YYYY-MM/YYYYMMDD_feature/
```

**更新索引：**

在 `.sopify/history/index.md` 添加记录：

```markdown
| YYYYMMDDHHMM | {功能名称} | {类型} | ✓ 已完成 | [链接](YYYY-MM/YYYYMMDD_feature/) |
```

---

## 步骤 5: 输出格式

**完全成功：**
```
[{BRAND_NAME}] 开发实施 ✓

完成: {N}/{N} 任务
测试: 通过

---
Changes: {N} files
  - src/xxx.vue
  - src/xxx.ts
  - .sopify/wiki/modules/xxx.md
  - .sopify/history/...

Next: 请验证功能
```

**部分成功：**
```
[{BRAND_NAME}] 开发实施 !

完成: {M}/{N} 任务
阻塞: {K} 项

阻塞任务:
  - [!] 2.3 {任务描述} - {阻塞原因}

---
Changes: {N} files
  - ...

Next: 解决阻塞后运行 ~go exec 继续
```

**快速修复模式 (简单任务直接执行)：**
```
[{BRAND_NAME}] 快速修复 ✓

修复: {一句话描述}

---
Changes: {N} files
  - {file1}
  - {file2}

Next: 请验证修复
```

---

## 特殊情况处理

### 执行中断

```yaml
情况: 用户中断或系统错误
处理:
  1. 保存当前进度到 tasks.md
  2. 已完成任务标记为 [x]
  3. 当前任务保持 [ ]
  4. 输出中断摘要
恢复: 运行 ~go exec 从中断处继续
```

### 任务失败

```yaml
情况: 某任务无法完成
处理:
  1. 标记为 [!] 并注明原因
  2. 尝试继续后续独立任务
  3. 输出失败详情
```

### 回滚需求

```yaml
情况: 用户要求回滚
处理:
  1. 使用 git 回滚变更
  2. 保留方案包在 plan/ (不迁移)
  3. 输出回滚确认
```

---

## 验证检查清单

**代码质量：**
- [ ] 代码风格符合项目规范
- [ ] 无 TypeScript/ESLint 错误
- [ ] 无明显性能问题

**功能完整性：**
- [ ] 所有任务已执行
- [ ] 边界情况已处理
- [ ] 错误处理完善

**知识库：**
- [ ] 相关文档已更新
- [ ] 方案包已迁移
- [ ] 索引已更新
