# sopify.config.yaml - Sopify (Sop AI) Skills Configuration
# Place this file in your project root directory
# All options have sensible defaults - only configure what you need to change

# ============================================================
# CORE CONFIGURATION (核心配置)
# ============================================================

# Brand name displayed in output
# "auto" = automatically detect from git remote or package.json
# Or set a custom name like "my-project-ai"
brand: auto

# Output language: zh-CN (简体中文) | en-US (English)
language: zh-CN

# Output style: minimal (clean, less emoji) | classic (with emoji)
output_style: minimal

# Title color in terminal: green | blue | yellow | cyan | none
# Applies to title line only; automatically falls back to plain text if color is unsupported
title_color: green

# ============================================================
# WORKFLOW CONFIGURATION (工作流配置)
# ============================================================

workflow:
  # Workflow mode:
  # - strict: Always follow 3-phase process (analyze → design → develop)
  # - adaptive: Auto-select based on task complexity (recommended)
  # - minimal: Skip planning, execute directly
  mode: adaptive

  # Requirement score threshold (1-10)
  # Tasks scoring below this will trigger follow-up questions
  require_score: 7

  # When true, AI decides autonomously even with low scores
  # When false, always ask user for clarification
  auto_decide: false

  # workflow-learning proactive capture policy:
  # - always: Capture all development tasks with full logs
  # - by_requirement: simple=off, medium=summary, complex=full
  # - manual: Capture only after explicit "start recording this task"
  # - off: Do not create new capture logs automatically
  # Note: replay/review/why intent recognition is always enabled.
  learning:
    auto_capture: by_requirement

# ============================================================
# PLAN PACKAGE CONFIGURATION (方案包配置)
# ============================================================

plan:
  # Plan level:
  # - auto: Select based on task complexity
  # - light: Single file (plan.md)
  # - standard: Three files (background.md, design.md, tasks.md)
  # - full: Complete structure with ADR and diagrams
  level: auto

  # Knowledge base directory (relative to project root)
  # Default: .sopify-skills (hidden directory)
  # Note: Changing this does not migrate existing history from the old directory.
  directory: .sopify-skills

# ============================================================
# MULTI-MODEL COMPARE MVP (多模型对比 MVP)
# ============================================================

multi_model:
  # Enable compare mode.
  enabled: false

  # Trigger policy:
  # - manual: trigger only when user inputs "~compare <question>" or "对比分析：<问题>"
  trigger: manual

  # Include current session default model as a compare candidate.
  # Defaults to true even when omitted.
  include_default_model: true

  # Context bridge switch (single bypass):
  # - true (default): when compare includes external candidates, build
  #   local context pack (extract -> redact -> truncate) and send with question.
  # - false: bypass context bridge and send only raw question.
  context_bridge: true

  # If no usable candidates are found (not configured/disabled/missing env keys),
  # compare requests should gracefully fallback to single-model execution.

  # Overall timeout for a compare request in seconds.
  timeout_sec: 25

  # Max number of models to call in parallel.
  max_parallel: 3

  # Candidate models.
  # API keys must come from environment variables; do not store plain keys here.
  candidates:
    - id: glm
      enabled: true
      provider: openai_compatible
      base_url: https://open.bigmodel.cn/api/paas/v4
      model: glm-4.7
      api_key_env: GLM_API_KEY
    - id: qwen
      enabled: true
      provider: openai_compatible
      base_url: https://dashscope.aliyuncs.com/compatible-mode/v1
      model: qwen-plus
      api_key_env: DASHSCOPE_API_KEY

# ============================================================
# ADVANCED CONFIGURATION (高级配置)
# ============================================================

advanced:
  # EHRB (Extreme High-Risk Behavior) detection level:
  # - strict: Block all risky operations
  # - normal: Warn and require confirmation
  # - relaxed: Only warn, don't block
  ehrb_level: normal

  # Knowledge base initialization strategy:
  # - full: Create all template files at once
  # - progressive: Create files as needed
  kb_init: progressive

  # Cache project info for faster startup
  cache_project: true
